{
  "id": "snapshot_1769409240662_ipmhjlryb",
  "approvalId": "approval_1769409119096_b5w90376j",
  "approvalTitle": "calendar-management-ui Tasks",
  "version": 2,
  "timestamp": "2026-01-26T06:34:00.662Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document - calendar-management-ui\n\n## 概要\n\nカレンダー管理UIの実装タスク。\n\n- Requirements: `.spec-workflow/specs/calendar-management-ui/requirements.md`\n- Design: `.spec-workflow/specs/calendar-management-ui/design.md`\n\n---\n\n## タスク一覧\n\n### Phase 1: Park UI コンポーネント準備\n\n- [ ] 1. Dialog コンポーネント作成\n  - File: `components/ui/dialog.tsx`\n  - Park UI Dialog の Ark UI ラッパー\n  - Purpose: モーダルダイアログの共通コンポーネント\n  - _Leverage: `components/ui/steps.tsx`（既存のArk UIラッパーパターン）_\n  - _Requirements: 3, 5_\n  - _Prompt: Implement the task for spec calendar-management-ui, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React/Park UI開発者 | Task: `components/ui/dialog.tsx`を作成。@ark-ui/react/dialogをラップし、Dialog.Root, Dialog.Backdrop, Dialog.Positioner, Dialog.Content, Dialog.Title, Dialog.Description, Dialog.CloseTriggerをエクスポート。Panda CSSでスタイリング | Restrictions: 既存のsteps.tsxパターンに従う | Success: Dialogが他コンポーネントから利用可能_\n\n- [ ] 2. Switch コンポーネント作成\n  - File: `components/ui/switch.tsx`\n  - Park UI Switch の Ark UI ラッパー\n  - Purpose: トグルスイッチの共通コンポーネント\n  - _Leverage: `components/ui/steps.tsx`_\n  - _Requirements: 4_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React/Park UI開発者 | Task: `components/ui/switch.tsx`を作成。@ark-ui/react/switchをラップし、Switch.Root, Switch.Control, Switch.Thumb, Switch.Labelをエクスポート。checked/onCheckedChangeプロパティ対応 | Success: Switchが他コンポーネントから利用可能_\n\n### Phase 2: カスタムフック\n\n- [ ] 3. useCalendars フック作成\n  - File: `hooks/useCalendars.ts`\n  - カレンダー一覧取得・トグル操作\n  - Purpose: カレンダーデータ管理\n  - _Leverage: `GET /api/calendars`, `PATCH /api/calendars/[id]`_\n  - _Requirements: 1, 4_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: useCalendarsフックを作成。useState/useEffectでカレンダー一覧取得、toggleCalendar関数でPATCH API呼び出し、refetch関数で再取得 | Restrictions: fetch API使用、エラーハンドリング必須 | Success: カレンダー一覧取得とトグル操作が動作_\n\n- [ ] 4. useAddGoogleCalendar フック作成\n  - File: `hooks/useAddGoogleCalendar.ts`\n  - Google OAuth フロー開始\n  - Purpose: Google認証管理\n  - _Leverage: `POST /api/calendars/google`_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: useAddGoogleCalendarフックを作成。startAuth関数でPOST /api/calendars/googleを呼び出し、返されたauthUrlでwindow.location.hrefをリダイレクト | Success: Google OAuth認証が開始される_\n\n- [ ] 5. useAddICalCalendar フック作成\n  - File: `hooks/useAddICalCalendar.ts`\n  - iCalカレンダー追加\n  - Purpose: iCal追加管理\n  - _Leverage: `POST /api/calendars/ical`_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: useAddICalCalendarフックを作成。addCalendar(url, name?)関数でPOST /api/calendars/icalを呼び出し | Success: iCalカレンダーが追加される_\n\n- [ ] 6. useDeleteCalendar フック作成\n  - File: `hooks/useDeleteCalendar.ts`\n  - カレンダー削除\n  - Purpose: 削除操作管理\n  - _Leverage: `DELETE /api/calendars/[id]`_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: useDeleteCalendarフックを作成。deleteCalendar(id)関数でDELETE /api/calendars/:idを呼び出し | Success: カレンダーが削除される_\n\n- [ ] 7. useSyncCalendars フック作成\n  - File: `hooks/useSyncCalendars.ts`\n  - カレンダー同期\n  - Purpose: 同期操作管理\n  - _Leverage: `POST /api/calendars/sync`_\n  - _Requirements: 6_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: useSyncCalendarsフックを作成。sync関数でPOST /api/calendars/syncを呼び出し、lastSyncTime状態を管理 | Success: 同期が実行され、結果が表示される_\n\n- [ ] 8. hooks index.ts 作成\n  - File: `hooks/index.ts`\n  - フックのバレルエクスポート\n  - Purpose: モジュール境界\n  - _Leverage: Phase 2の全フック_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: TypeScript開発者 | Task: `hooks/index.ts`を作成し、全カスタムフックをエクスポート | Success: `import { useCalendars } from '@/hooks'`が動作_\n\n### Phase 3: UIコンポーネント\n\n- [ ] 9. SyncStatusBadge コンポーネント作成\n  - File: `components/calendar/SyncStatusBadge.tsx`\n  - 同期状態バッジ\n  - Purpose: 最終同期時刻・エラー表示\n  - _Leverage: Panda CSS_\n  - _Requirements: 6_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: SyncStatusBadgeを作成。lastSyncTime, hasErrorプロパティを受け取り、「5分前」「同期エラー」などを表示 | Success: 同期状態が視覚的にわかる_\n\n- [ ] 10. CalendarCard コンポーネント作成\n  - File: `components/calendar/CalendarCard.tsx`\n  - 個別カレンダー表示\n  - Purpose: カレンダー情報と操作UI\n  - _Leverage: `components/setup/ProviderCard.tsx`パターン, `components/ui/switch.tsx`_\n  - _Requirements: 1, 4, 5_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: CalendarCardを作成。CalendarConfigを受け取り、タイプアイコン、名前、メールアドレス（Google）、有効/無効Switch、削除ボタン、SyncStatusBadgeを表示 | Restrictions: ProviderCardのスタイルパターンに従う | Success: カレンダー情報が見やすく表示される_\n\n- [ ] 11. CalendarList コンポーネント作成\n  - File: `components/calendar/CalendarList.tsx`\n  - カレンダー一覧\n  - Purpose: 全カレンダーのリスト表示\n  - _Leverage: CalendarCard_\n  - _Requirements: 1_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: CalendarListを作成。calendars配列をmap、空の場合は「カレンダーを追加してください」メッセージ表示 | Success: カレンダー一覧が表示される_\n\n- [ ] 12. AddGoogleCalendarButton コンポーネント作成\n  - File: `components/calendar/AddGoogleCalendarButton.tsx`\n  - Google追加ボタン\n  - Purpose: OAuth開始トリガー\n  - _Leverage: useAddGoogleCalendar_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: AddGoogleCalendarButtonを作成。クリックでuseAddGoogleCalendar.startAuth()を呼び出し、ローディング状態表示 | Success: ボタンクリックでOAuth開始_\n\n- [ ] 13. AddICalDialog コンポーネント作成\n  - File: `components/calendar/AddICalDialog.tsx`\n  - iCal追加ダイアログ\n  - Purpose: URL入力フォーム\n  - _Leverage: `components/ui/dialog.tsx`, `components/setup/ApiKeyForm.tsx`パターン_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: AddICalDialogを作成。Dialog内にURL入力欄（必須）、カレンダー名入力欄（任意）、キャンセル/追加ボタン。バリデーションエラー表示 | Restrictions: ApiKeyFormの入力パターンに従う | Success: iCal URLが入力・送信できる_\n\n- [ ] 14. DeleteCalendarDialog コンポーネント作成\n  - File: `components/calendar/DeleteCalendarDialog.tsx`\n  - 削除確認ダイアログ\n  - Purpose: 削除前確認\n  - _Leverage: `components/ui/dialog.tsx`_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: DeleteCalendarDialogを作成。カレンダー名を表示し、「削除」「キャンセル」ボタン。削除中はローディング表示 | Success: 削除前に確認ができる_\n\n- [ ] 15. calendar components index.ts 作成\n  - File: `components/calendar/index.ts`\n  - コンポーネントのバレルエクスポート\n  - Purpose: モジュール境界\n  - _Leverage: Phase 3の全コンポーネント_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: TypeScript開発者 | Task: `components/calendar/index.ts`を作成し、全コンポーネントをエクスポート | Success: `import { CalendarList } from '@/components/calendar'`が動作_\n\n### Phase 4: ページ実装\n\n- [ ] 16. CalendarsClientWrapper コンポーネント作成\n  - File: `components/calendar/CalendarsClientWrapper.tsx`\n  - クライアント状態管理\n  - Purpose: 全体の状態オーケストレーション\n  - _Leverage: 全カスタムフック, 全UIコンポーネント_\n  - _Requirements: 1-6_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: CalendarsClientWrapperを作成。useCalendars等でデータ取得、ダイアログ開閉状態管理、OAuth成功/エラーのURLパラメータ処理、CalendarList/AddGoogleCalendarButton/AddICalDialog/DeleteCalendarDialogを配置 | Success: カレンダー管理の全機能が動作_\n\n- [ ] 17. カレンダー設定ページ作成\n  - File: `app/settings/calendars/page.tsx`\n  - 設定ページ\n  - Purpose: ルーティングエントリーポイント\n  - _Leverage: CalendarsClientWrapper_\n  - _Requirements: 1_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: Next.js開発者 | Task: `/settings/calendars`ページを作成。ヘッダーに「カレンダー設定」タイトル、CalendarsClientWrapperを配置 | Success: /settings/calendarsでカレンダー設定画面が表示される_\n\n- [ ] 18. SetupComplete にカレンダー設定リンク追加\n  - File: `components/setup/SetupComplete.tsx`（修正）\n  - セットアップ完了後の導線\n  - Purpose: カレンダー設定への誘導\n  - _Leverage: 既存のSetupComplete_\n  - _Requirements: Usability_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: React開発者 | Task: SetupCompleteに「カレンダーを設定」ボタンを追加、クリックで/settings/calendarsへ遷移 | Restrictions: 既存レイアウトを崩さない | Success: セットアップ完了後にカレンダー設定へ遷移できる_\n\n### Phase 5: API拡張\n\n- [ ] 19. カレンダー有効/無効切替API追加\n  - File: `app/api/calendars/[id]/route.ts`（修正）\n  - PATCH メソッド追加\n  - Purpose: トグル操作のAPI\n  - _Leverage: 既存のDELETEハンドラ_\n  - _Requirements: 4_\n  - _Prompt: Implement the task for spec calendar-management-ui: Role: Next.js開発者 | Task: `/api/calendars/[id]`にPATCHハンドラ追加。リクエストボディ`{ enabled: boolean }`を受け取り、設定を更新 | Success: カレンダーの有効/無効がAPIで切り替えられる_\n\n---\n\n## 依存関係\n\n```\nPhase 1 (Park UI)\n  └─> Phase 2 (Hooks)\n        └─> Phase 3 (Components)\n              └─> Phase 4 (Page)\n\nPhase 5 (API) は Phase 2 と並行可能\n```\n\n## 実装順序\n\n1. **Phase 1** (タスク1-2): Park UI コンポーネント準備\n2. **Phase 2** (タスク3-8): カスタムフック\n3. **Phase 3** (タスク9-15): UIコンポーネント\n4. **Phase 4** (タスク16-18): ページ実装\n5. **Phase 5** (タスク19): API拡張\n\n---\n\n## 完了基準\n\n- すべてのタスクが完了していること\n- `npm run build` が成功すること\n- `npx biome check .` でエラーがないこと\n- `/settings/calendars` でカレンダー一覧が表示されること\n- Googleカレンダー追加ボタンでOAuthが開始されること\n- iCalダイアログでカレンダーが追加できること\n- トグルでカレンダーの有効/無効が切り替えられること\n- 削除ダイアログでカレンダーが削除できること\n- 同期ボタンで全カレンダーが同期されること\n",
  "fileStats": {
    "size": 12284,
    "lines": 208,
    "lastModified": "2026-01-26T06:31:52.661Z"
  },
  "comments": []
}